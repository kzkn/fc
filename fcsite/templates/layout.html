{% set active_page = active_page | default('') %}

{% macro show_notice_messages(category, class, direct_msgs) %}
  {% with msgs = get_flashed_messages(category_filter=[category]) %}
    {% if direct_msgs or msgs %}
      {% for msg in (direct_msgs + msgs) %}
<div class="alert alert-block alert-{{ class }}">
  <button type="button" class="close" data-dismiss="alert">&times;</button>
  <h4 class="alert-heading">{{ msg.split(':', 1)[0] }}</h4>
  {{ msg.split(':', 1)[1] | safe }}
</div>
      {% endfor %}
    {% endif %}
  {% endwith %}
{% endmacro %}

<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>Fight Club</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <style>
      body {
          padding-top: 60px;
          padding-bottom: 40px;
      }
    </style>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap-responsive.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {% block css %}
    {% endblock %}

    <script src="{{ url_for('static', filename='js/libs/modernizr-2.5.3-respond-1.1.0.min.js') }}"></script>
  </head>
  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="{{ url_for('general.index') }}">Fight Club</a>
          <div class="nav-collapse">
            <ul class="nav">
              {% set navigations = [
                     ('general.index', 'index', 'icon-home', 'ホーム', False),
                     ('schedule.schedule', 'schedule', 'icon-calendar', '活動予定', True),
                     ('member.member', 'member', 'icon-user', 'メンバー', False),
                     ('bbs.index', 'bbs', 'icon-list-alt', '掲示板', True),
                     ('message', 'message', 'icon-envelope', '私書箱', True),
                 ]
              %}
              {% for view, id, icon, caption, require_login in navigations %}
              {% if not require_login or (require_login and g.user) %}
              <li{% if active_page == id %} class="active"{% endif %}>
                <a href="{{ url_for(view) }}">
                  <i class="{{ icon }} icon-white"></i> {{ caption }}
                </a>
              </li>
              {% endif %}
              {% endfor %}
            </ul>
            <ul class="nav pull-right">
              {% if g.user %}
              <li{% if active_page == 'mysettings' %} class="active"{% endif %}>
                <a href="{{ url_for('member.profile') }}">個人設定</a>
              </li>
              {% endif %}
              {% if is_admin() %}
              <li{% if active_page == 'admin' %} class="active"{% endif %}>
                <a href="{{ url_for('admin.index') }}">管理</a>
              </li>
              {% endif %}
              <li class="dropdown">
                <a class="dropdown-toggle" href="#" data-toggle="dropdown">
                {% if g.user %}
                {{ g.user['name'] }}
                {% else %}
                ログイン
                {% endif %}
                <strong class="caret"></strong></a>
                {% if g.user %}
                <ul class="dropdown-menu">
                  <li><a href="{{ url_for('general.logout') }}">ログアウト</a></li>
                </ul>
                {% else %}
                <div class="dropdown-menu" style="padding: 15px; padding-bottom: 0;">
                  <form action="{{ url_for('general.login') }}" method="post">
                    <input id="user_password" style="margin-bottom: 15px;" type="password" name="password" size="30" placeholder="パスワード" autocomplete="off"></input>
                    <input class="btn btn-primary" style="clear: left; width: 100%; height: 32px; font-size: 13px;" type="submit" name="commit" value="ログイン"></input>
                  </form>
                </div>
                {% endif %}
              </li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      {{ show_notice_messages('error', 'error', error_msgs if error_msgs is defined else []) }}
      {{ show_notice_messages('info', 'success', info_msgs if info_msgs is defined else []) }}

      {% block maincontent %}
      {% endblock %}

      <hr>

      <footer>
        <p>困ったことがあれば Y.K までご連絡を。すぐにかけつけます。</p>
      </footer>

    </div> <!-- /container -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="{{ url_for('static', filename='js/libs/jquery-1.7.2.min.js') }}"><\/script>')</script>

    <script src="{{ url_for('static', filename='js/libs/bootstrap/bootstrap.min.js') }}"></script>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    {% block script %}
    {% endblock %}
  </body>
</html>
