{% extends 'layout.html' %}
{% set active_page = 'schedule' %}

{% macro entries_list(schedule) %}
<h5><i class="icon-ok-circle"></i> 参加</h5>
<dl>
  {% for e in schedule.entries %}
    {% if e.is_entry %}
  <dt class="enter">{{ e.user_name }}</dt>
  <dd class="enter">{{ e.comment }}</dd>
    {% endif %}
  {% endfor %}
</dl>
<h5><i class="icon-remove-circle"></i> 不参加</h5>
<dl>
  {% for e in schedule.entries %}
    {% if not e.is_entry %}
  <dt class="leave">{{ e.user_name }}</dt>
  <dd class="leave">{{ e.comment }}</dd>
    {% endif %}
  {% endfor %}
</dl>
{% endmacro %}

{% block maincontent %}
      <div class="subhead visible-desktop">
        <h1>活動予定</h1>
        <p class="lead">
          近々の活動予定の一覧です。練習からイベントまで、参加しまくりましょう。
          練習しただけうまくなれる! 飲んだ数だけ強くなれる!
        </p>
      </div>

      <div class="row">
        <div class="span4">
          <h2>練習 <small>やるんダ!</small></h2>
          <div class="accordion" id="practices">
            {% for p in practices %}
            <div class="accordion-group">
              <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#practices" href="#practice{{ p.id }}">
                  {{ p.when_ | datetimeformat }}-{{ p.end }} @{{ p.loc }} ({{ p.entry_count }}人) {% if not is_registered(g.user, p) %}<span class="label label-info">未登録</span>{% endif %}
                </a>
              </div>
              <div id="practice{{ p.id }}" class="accordion-body collapse">
                <div class="accordion-inner">
                  {% if g.user %}
                  <form action="{{ url_for('schedule.entry', sid=p.id) }}" method="post" class="well">
                    <input type="text" name="comment" class="input-large" placeholder="コメント"></input>
                    <input class="btn btn-primary" type="submit" name="action" value="参加する"></input>
                    <input class="btn" type="submit" name="action" value="参加しない"></input>
                  </form>
                  {% endif %}
                  <table class="table table-bordered">
                    <tbody>
                      <tr>
                        <td>
                          <dl>
                            <dt>コート</dt>
                            <dd>{{ p.court }}</dd>
                            <dt>予約番号</dt>
                            <dd>{{ p.no }}</dd>
                            <dt>コート代</dt>
                            <dd>{{ p.price }}円</dd>
                            <dt>備考</dt>
                            <dd>{{ p.note | safe }}</dd>
                          </dl>
                        </td>
                      </tr>
                      <tr>
                        <td>
                          {{ entries_list(p) }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        <div class="span4">
          <h2>試合 <small>勝つんダ!</small></h2>
          <div class="accordion" id="games">
            {% for ga in games %}
            <div class="accordion-group">
              <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#games" href="#game{{ ga.id }}">
                  {{ ga.name }} @{{ ga.loc }} ({{ ga.entry_count }}人) {% if not is_registered(g.user, ga) %}<span class="label label-info">未登録</span>{% endif %}
                </a>
              </div>
              <div id="game{{ ga.id }}" class="accordion-body collapse">
                <div class="accordion-inner">
                  {% if g.user and not ga.deadline_overred %}
                  <form action="{{ url_for('schedule.entry', sid=ga.id) }}" method="post" class="well">
                    <input type="text" name="comment" class="input-large" placeholder="コメント"></input>
                    <input class="btn btn-primary" type="submit" name="action" value="参加する"></input>
                    <input class="btn" type="submit" name="action" value="参加しない"></input>
                  </form>
                  {% endif %}
                  <table class="table table-bordered">
                    <tbody>
                      <tr>
                        <td>
                          <dl>
                            <dt>開催日</dt>
                            <dd>{{ ga.when_ | dateformat }}</dd>
                            <dt>ジャンル</dt>
                            <dd>{{ ga.genre }}</dd>
                            <dt>締め切り</dt>
                            <dd>{{ ga.deadline }}</dd>
                            <dt>試合代</dt>
                            <dd>{{ ga.price }}円</dd>
                            <dt>受付開始</dt>
                            <dd>{{ ga.begin_acceptance }}</dd>
                            <dt>試合開始</dt>
                            <dd>{{ ga.begin_game }}</dd>
                            <dt>備考</dt>
                            <dd>{{ ga.note | safe }}</dd>
                          </dl>
                        </td>
                      </tr>
                      <tr>
                        <td>
                          {{ entries_list(ga) }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        <div class="span4">
          <h2>イベント <small>遊ぶんダ!</small></h2>
          <div class="accordion" id="events">
            {% for e in events %}
            <div class="accordion-group">
              <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#events" href="#event{{ e.id }}">
                  {{ e.name }} @{{ e.loc }} ({{ e.entry_count }}人) {% if not is_registered(g.user, e) %}<span class="label label-info">未登録</span>{% endif %}
                </a>
              </div>
              <div id="event{{ e.id }}" class="accordion-body collapse">
                <div class="accordion-inner">
                  {% if g.user and not e.deadline_overred %}
                  <form action="{{ url_for('schedule.entry', sid=e.id) }}" method="post" class="well">
                    <input type="text" name="comment" class="input-large" placeholder="コメント"></input>
                    <input class="btn btn-primary" type="submit" name="action" value="参加する"></input>
                    <input class="btn" type="submit" name="action" value="参加しない"></input>
                  </form>
                  {% endif %}
                  <table class="table table-bordered">
                    <tbody>
                      <tr>
                        <td>
                          <dl>
                            <dt>開催日</dt>
                            <dd>{{ e.when_ | dateformat }}</dd>
                            <dt>締め切り</dt>
                            <dd>{{ e.deadline }}</dd>
                            <dt>費用</dt>
                            <dd>{{ e.price }}円</dd>
                            <dt>内容</dt>
                            <dd>{{ e.description | safe }}</dd>
                          </dl>
                        </td>
                      </tr>
                      <tr>
                        <td>
                          {{ entries_list(e) }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
{% endblock %}
